% https://home.hirosaki-u.ac.jp/masumi/100/
\documentclass[a4paper, 12pt]{jsreport}
\usepackage{bm}
\usepackage[dvipdfmx]{graphicx}
\usepackage{ascmac}
\usepackage{amsmath}
% https://www.imperial.ac.uk/media/imperial-college/administration-and-support-services/library/public/LaTeX-example-Harvard-apr-2019.pdf
\usepackage{natbib}

\title{機械学習アルゴリズムによる\\
  日本企業の四半期利益予測}
\author{早稲田大学大学院商学研究科 商学専攻\\
  35201064　王思涵}
\date{2020年月日}

\begin{document}
\maketitle
\tableofcontents

\chapter{はじめに}

1株当たり利益（Earnings Per Share: EPS）は株式1つ当たりに対する企業の当期純利益を表した指標である. EPSは企業の当期純利益を発行株式数で割ることで求められており, 規模に依存しない企業の収益性を示す. 企業外部のステークホルダーである投資家は, 企業の将来のEPSの予測をもとに, 収益性の高いポートフォリオを構築したり, 将来の株価収益率を算出して投資判断を行う. また, 企業内部の経営者は将来のEPSの予測を用いて, 営業予算の作成や設備投資の判断などの重要な意思決定を行う. したがって, EPSを正しく予測することは企業内外の幅広いステークホルダーにとって重要である. 

企業の将来利益の予測は, 人的な予測と, 統計的・機械的な予測の2つに大別できる\citep{sakurai1990}. 人的な予測の代表として, アナリスト予測がある. アナリスト予測とは, 株式市場分析の専門家である証券アナリストが公表する利益予測である. 他方, 統計的・機械的な予測とは, 過去の実績データをもとに何らかの時系列モデルを用いて将来の利益を予測することである. モデルに基づく予測は, 予測値を導出するまでの過程を全て機械化できるため, 人的な予測に比べてコストが低いという特徴を有している\citep{sakurai1990}. 

統計的・機械的な予測に関する研究で用いられているモデルは, 1)「単変量」か「多変量」か, 2)「線形」か「非線形」か, の2つの観点で分類できる\citep{zhang2004neural}. 従来の, モデルに基づくEPS予測の研究の多くは, 自己回帰和分移動平均(AutoRegressive Integrated Moving Average: ARIMA)モデル\citep*{box2015time}などの単変量で線形な統計的時系列モデルを用いている(e.g., 英語のもっと古い論文). 一方, 近年の研究では, 「ファンダメンタル会計変数」を用いた多変量モデルによるEPS予測の研究が増えている. ファンダメンタル会計変数とは, 売掛金, 棚卸資産, 資本的支出といったいくつかの会計変数のことであり, これらの変数には将来のEPSを予測する情報があるとされている\citep{lev1993fundamental, abarbanell1997fundamental}. また, 四半期EPSデータには非線形性があるとされており\citep*{hopwood1986univariate}, これを考慮するために, 予測モデルに非線形性を反映させている研究も盛んである. 中でも従来の統計的時系列モデルに代替されるモデルとして, 機械学習アルゴリズムが注目されている. 機械学習アルゴリズムは, 統計的時系列モデルに比べて, 高次元データの処理に長けたモデルや非線形性を捉えられるモデルが豊富にある\citep*{cao2020fundamental}. そのため機械学習アルゴリズムを用いることで, 多変量なファンダメンタル会計変数から予測情報を抽出し企業利益の非線形を捉え, 高い精度のEPS予測が得られると考えられる. 

機械学習アルゴリズムによる企業のEPS予測の研究の前例として, \cite{zhang2004neural}はアメリカのニューヨーク証券取引所の上場企業, \cite*{cao2009forecasting} は中国の上海証券取引所と深セン証券取引所の上場企業, \cite{etemadi2015earnings}はイランのテヘラン証券取引所の上場企業を対象に, 機械学習アルゴリズムの1つであるANNモデルによる四半期EPSの予測を行っている. また, \cite*{cao2020fundamental}はアメリカの上場企業を対象に, いくつかの代表的な機械学習アルゴリズムを用いた年次EPS予測を行っている. いずれの研究においても機械学習アルゴリズムが精度の高い予測をもたらす結果となっている. 

このように近年, 統計的・機械的な手法によるEPS予測の研究分野では, 機械学習アルゴリズムを用いて, モデルに多変量と非線形な特性を反映させることで予測の精度が向上することが様々な国のサンプルで確認されている. しかし, \cite{ota2006}によると人的な予測と従来の時系列モデル予測の精度比較研究については, 明確な結論が出ていないにも拘らず, モデルによる予測よりも人的な予測の方が適切であると暗黙裡に見なされており, 時系列モデルによる予測の研究は, 現在では衰退しているとされている. 現に日本における統計的・機械的なEPS予測の研究は限定的で, 従来の線形時系列モデルの適用に留まっており, 高い予測精度が期待される機械学習アルゴリズムによる日本企業データを用いたEPS予測の研究は, 筆者の知る限り存在しない. また, 日本ではモデルによる利益予測が衰退したあとの2008年度に四半期報告制度ができているため, 四半期データを用いたEPS予測の研究もない. 

そこで本稿は, 日本企業データにおいて代替的な時系列予測モデルである機械学習アルゴリズムが, 統計的・機械的な手法によるEPS予測の精度を向上させるのか, 人的な予測よりも高い精度の予測をもたらすのかを検証する. 具体的には東京証券取引所一部上場企業を対象に機械学習アルゴリズムによる四半期EPS予測を行い, 得られた予測値を用いて従来の線形時系列モデルによる予測やアナリストによる予測と精度比較をする. さらに, 機械学習アルゴリズムによる予測と各手法による予測の組み合わせ予測\citep*{bates1969combination}を求めて, 機械学習アルゴリズムによる予測に他の予測手法の精度を向上させる情報を含んでいるかどうかを調べる. 追加的な検証として, 機械学習アルゴリズムによる予測値と各手法による予測値それぞれに基づいた株価予想利益率からロング・ショートポートフォリオを構築し, それを日本の証券市場に適用させて, 機械学習アルゴリズムによる予測と各手法による予測の投資指標としての有用性を考察する. 

本稿の構成は以下のとおりである。第2章では、、、

\chapter{過去の研究}

これまで多くの企業利益予測の研究で、統計的・機械的な予測手法間の精度比較、統計的・機械的な予測手法と人的な予測手法の精度比較、人的な予測手法間の精度比較が行われている。\cite{sakurai1990}や\cite{ota2006}のレビュー論文は、そのような数々の利益予測の研究に関する文献についてまとめている。アメリカの利益予測の研究に関して、\cite{sakurai1990}は以下のようにまとめている。まずEPSを予測する伝統的な時系列モデルについて、年次EPSはランダムウォークモデルによってうまく描写され、四半期EPSは\cite*{brown1979univariate}、\cite{griffin1977time}、\cite{foster1977quarterly}の3つのARIMAモデルによってうまく描写されるとしている。一方で、アナリスト予測と伝統的な時系列モデルによる予測の比較については、アナリストによる年次および四半期のEPS予測が伝統的な時系列モデルによる予測よりも正確であると述べている。その理由として、アナリストは広く最新な情報集合を予測に用いるからであるとしている。\cite{ota2006}では、日本の利益予測に関する研究の数が非常に少ないとしつつも、アメリカと同様な比較結果を得ているとしている。そして、時系列モデルによる予測に関しては、アナリスト予測との精度比較の明確な結論が出ていないにも拘わらず、最近の研究では時系列モデルによる予測よりもアナリスト予測を用いる方が市場の期待利益として適切であると暗黙裡に見なされており、時系列モデル予測の研究は、現在では衰退していると述べている。

ここで注意するべき点として、上記で言及されているEPS予測精度の比較の研究で扱われている時系列モデルの多くは、あくまでも当時研究が盛んであった伝統的な単変量で線形の時系列モデルのことであり、代替的な多変量モデルや非線形モデルについては議論されていない。\cite{ota2006}は「ナイーブな時系列を用いた場合には経営者予測の方が精度が高いが、高度な時系列モデルを用いた場合には時系列モデルの予測の方が人的予測よりも精度が高いといえる」と述べ、モデルの改善により統計的・機械的なEPS予測の精度は向上する余地があること示唆している。

近年、多くの学術分野で応用され成果を上げている予測モデルとして、機械学習アルゴリズムの1つである人工ニューラルネットワーク(Artificial Neural Network: ANN)モデルが挙げられる。ANNモデルは生物の神経細胞(ニューロン)の構造と機能をもとに考案された数学モデルであり、従来の統計モデルに比べて非線形で不定形な問題にうまく対処できることから、多数の分野での利用が増加している\citep*{tkavc2016artificial}。特に、\cite{hill1996neural}は、月次や四半期の時系列予測においてANNモデルの方が伝統的な統計モデルよりも正確な予測を与えるとし、時系列予測におけるANNモデルの有用性を示している。その理由として、ANNはあらゆる関数形を近似できる普遍性定理(Universal Approximation Theorem)\citep{hornik1989multilayer}により、伝統的な線形統計モデルでは捉えられない時系列データの非線形性を捉え、予測モデルの関数形の誤特定を回避できるからであると述べている。また、\cite{hill1994artificial}は、予測の対象である時系列データが、i)財務的、ii)季節的、iii)非線形な特徴を有するとき、ANNモデルによる予測は従来の線形時系列モデルよりも精度が高い傾向があると述べている。特に四半期EPSは上記の3つの特徴を有することも確認されている\citep*{hopwood1986univariate}。

そこで、\cite{callen1996neural}はニューヨーク株式市場の企業を対象に、単変量の四半期EPS予測におけるANNモデルと従来の統計的手法であるARIMAモデルとの精度を比較してANNの予測精度を検証したが、結果は予想に反してANNモデルによる予測がARIMAモデルによる予測よりも精度が低かった。そして、この研究ではANNの予測精度は文脈依存であると結論付けている。(Hillのディスポイント)

一方、会計学の研究では、企業利益の予測について、将来の利益を説明する変数を特定することに注目してきた。\cite*{lev1993fundamental}は、アナリストが有価証券の価値評価において有用であるとしている会計変数を調査し、それらの会計変数が将来の企業利益と関連があると述べている。言及された会計変数は以下のとおりである。

\begin{itemize}
\item 棚卸資産 (Inventories) \\
    売上原価の増加に対して過度な棚卸資産の増加は、売上高を増加させることが困難であることを示唆するため、ネガティブなシグナルとみなされる。さらに、棚卸資産が増加すると経営者は在庫を減らそうとするため、将来の利益が減少するシグナルになり得る。

\item 売掛金 (Accounts receivable) \\
    売上高に対して過度な売掛金の増加は、企業の製品販売が困難な状態にあることや、賃倒引当金の増加などを意味し、将来の利益が減少するシグナルになり得る。

\item 資本的支出 (Capital expenditures) \\
    資本的支出の過度な減少は、以前の投資水準を維持するための現在および将来のキャッシュフローが十分でないという経営者の懸念を意味する。このように一般的に資本的支出の減少は、短期的な経営志向とみなされ、将来の利益が減少するシグナルになり得る。

\item 売上総利益 (Gross margin) \\
    売上総利益は企業の競争の激しさや営業レバレッジなどの要因を捉え、これが企業の長期的なパフォーマンスに影響を与える。したがって、売上総利益は企業の利益の持続性や企業価値に関して有益な情報をもち、売上高に対して過度な売上総利益の減少は、将来の利益が減少するシグナルになり得る。

\item 販売費および一般管理費 (Selling and administrative expenses) \\
    ほとんどの場合、販売費および一般管理費は一定であるため、売上高に対して過度な販売費および一般管理費の増加は、コストコントロールの喪失や異常な販売努力を示唆し、将来の利益が減少するシグナルになり得る。

\item 実効税率 (Effective tax rate) \\
    法定税率の変更に依らない企業の実効税率の大幅な変化は、一般的には一時的なものとして捉えられる。したがって、過度な実効税率の低下は将来の利益が減少するシグナルになり得る。

\item 労働力 (Labor force) \\
    一般的に労働力の削減の発表に対してアナリストは好意的な反応を示す。したがって、過度な労働力の増加は将来の利益が減少するシグナルになり得る。
\end{itemize}

\cite*{abarbanell1997fundamental}では、上記の会計変数を「ファンダメンタル会計変数」とし、ファンダメンタル会計変数が将来のEPSの変化を説明するかどうかについて検証している。分析の結果、ファンダメンタル会計変数と将来のEPSの変化の間に強い関係が確認され、ファンダメンタル会計変数に含まれる会計情報は、将来のEPSに対して予測能力を持つと述べている。

これを受け\cite{zhang2004neural}は、\cite{callen1996neural}の単変量ANNモデルによる四半期EPS予測の研究を発展させる形で、ANNモデルにファンダメンタル会計変数を反映させた多変量ANNモデルによる四半期EPS予測を行った。この研究では、単変量線形モデル、多変量線形モデル、単変量ANNモデル、多変量ANNモデルの4つの精度比較を行い、結果として、ANNモデルは線形モデルよりもうまくファンダメンタル会計変数の情報を反映し、より精度の高いEPSの予測値を与えた。その後、様々な国のサンプルでEPS予測におけるANNモデルの有用性を示した研究が行われている。\cite*{cao2009forecasting} は中国の上海証券取引所と深セン証券取引所の上場企業、\cite{etemadi2015earnings}はイランのテヘラン証券取引所の上場企業を対象に、ファンダメンタル会計変数を反映させたANNモデルによるEPS予測を行っており、いずれも高い精度の予測を与える結果を得ている。

このように近年の四半期EPS予測の研究では機械学習アルゴリズムの1つとしてANNモデルが盛んに用いられているが、他の機械学習アルゴリズムを用いた研究は限られている。これはEPS予測の文脈に限らず、他の時系列予測研究でもANNモデルのみに着目している傾向がある\citep{ahmed2010empirical}。一方、ANNモデル以外の機械学習アルゴリズムが四半期EPS予測において成果を上げられる可能性も十分にある。代表的な機械学習アルゴリズムとして、正則化回帰モデルやランダム・フォレスト回帰モデルが挙げられる\citep{hastie2009esl}。正則化回帰モデルは、高次元データに対して変数選択・係数縮小を行うことで多数の説明変数から目的変数を予測する情報を抽出し、精度の高い予測を行うことができるため、四半期EPSの多変量予測において有用であると考えられる。また、ノンパラメトリックで非線形なランダム・フォレスト回帰モデル\citep{breiman2001random}も、ANNモデルとは異なったアルゴリズムで四半期EPSデータの非線形性を捉えることができると考えられる。\cite*{cao2020fundamental}は年次ではあるものの、これらの代表的な機械学習アルゴリズムを用いたEPS予測をしており、ベンチマークであるランダムウォーク(Random Walk: RW)モデルよりも精度の高い予測を与える結果となっている。

(Hill et al のANNディスも少し入れる)

以上の過去の研究を踏まえ、現状の日本のEPS予測における「時系列モデルが古典的な手法にとどまっていること」と「時系列モデルと人的な予測の優劣の曖昧さ」の2つの課題に対し、本稿は機械学習アルゴリズム(ANNモデル、正則化回帰モデル、ランダム・フォレスト回帰モデル)にファンダメンタル会計変数を含めて日本企業の四半期EPSの予測を行い、さらに時系列モデルとアナリストのEPS予測精度を比較し、予測手法間の精度の優劣を明らかにする。

\chapter{データ}

\section{サンプルデータ}

日本の四半期報告制度は比較的新しく、2007年の企業会計基準委員会(ASBJ)による企業会計基準第12号「四半期財務諸表に関する会計基準」及び企業会計基準適用指針第14号「四半期財務諸表に関する会計基準の適用指針」の公表以降、上場企業の四半期報告書の提出が義務付けられた。\footnote{2011年に企業会計基準委員会(ASBJ)は改正企業会計基準第12号「四半期財務諸表に関する会計基準」及び改正企業会計基準適用指針第14号「四半期財務諸表に関する会計基準の適用指針」等の公表をしている。この四半期報告制度の改正では財務諸表作成者の作成負担を考慮し、いくつかの四半期情報の開示を義務ではなく任意としている。それに伴い、四半期報告制度の改正以降、資本的支出と期末従業員数の観測される頻度が減り、欠損が多く見られる。\cite{zhang2004neural}は四半期単位で欠損している資本的支出と期末従業員数について、資本的支出は毎四半期均等であるとし、期末従業員数は前期の値を維持すると仮定して、欠損値を補填している。本稿でもこの方法に倣って資本的支出と期末従業員数の欠損処理を行うこととする。}

これにより、四半期データを分析の単位とする本稿では、サンプル期間を四半期報告制度が適用された2008年度(2008年4月1日)から現在2020年度(2021年3月31日)までの計52四半期とする。また、本稿の分析対象企業(サンプル企業)を、サンプル期間において以下の基準で選択する。

\begin{itemize}
  \item 東京証券取引所一部上場企業
  \item 3月決算企業
  \item 一般事業者(「銀行業」、「証券、商品先物取引業」、「保険業」、「その他金融業」を除く)
  \item 各四半期の中間月末(5月末, 8月末, 11月末, 2月末)までに前四半期決算を発表している企業\footnote{IBES予測及びポートフォリオ構築のタイミングをそろえるため。}
\end{itemize}

四半期EPS(3ヶ月)およびファンダメンタル会計変数の算出に必要な四半期会計データは「日経NEEDS-FinancialQUEST」から収集している。結果、1020社、延べ 1020社 × 52四半期 = 53040個の企業四半期が最終サンプルである。図表はサンプル企業の所属業種の割合を示している。なお、所属業種は証券コード協議会の中分類(全33種)に基づいている。

% ![ind_cat](/mnt/d/0ngoing/thesis/repo/paper/my_writing/imgs/_ind_cat_table.png) 

\section{目的変数}

予測の対象となる四半期1株あたり利益(四半期EPS)は以下のように定義される。

\begin{equation}
  \begin{split}
    Y &= \text{四半期 1株あたり利益} \\
    &= \frac{普通株式に係る四半期当期純利益}{普通株式の期中加重平均株式数} \\
    &= \frac{損益計算書上の四半期当期純利益-普通株式に帰属しない金額}{普通株式の期中加重平均発行済株式数 - 普通株式の期中加重平均自己株式数} \\  
  \end{split}
\end{equation}

\section{説明変数}

単変量モデルによる四半期EPS予測は、過去の四半期EPSのみを説明変数として用いる。一方、多変量モデルによって四半期EPSを予測する場合は、過去の四半期EPSに加えて、\cite{lev1993fundamental}や\cite{abarbanell1997fundamental}が企業の将来のEPSに対して予測能力を持つと言及しているファンダメンタル会計変数を説明変数として用いる。本稿では、ファンダメンタル会計変数を実際に四半期EPS予測に用いた\cite{zhang2004neural}に倣って以下のように7つのファンダメンタル会計変数を定義する。

\begin{equation}
  \begin{split}
    INV &= \frac{棚卸資産(円)}{普通株式の期中加重平均株式数} \\
    AR &= \frac{売掛金(円)}{普通株式の期中加重平均株式数} \\
    CAPX &= \frac{資本的支出(円)}{普通株式の期中加重平均株式数} \\
    GM &= \frac{売上総利益(円)}{普通株式の期中加重平均株式数} \\
    SA &= \frac{販売費及び一般管理費(円)}{普通株式の期中加重平均株式数} \\
    ETR &= \frac{法人税(円)}{税引前利益(円)} \\
    LF &= \log{\left(\frac{売上高(円)}{従業員数(人)}\right)} \\
  \end{split}
\end{equation}

多変量モデルによる予測では四半期EPSとファンダメンタル会計変数の4期までのラグを説明変数として用いる。図表は予測に用いた変数の記述統計、及び相関行列を示している。

% ![var_sum](/mnt/d/0ngoing/thesis/repo/paper/my_writing/imgs/_variable_sum_table.png) 

\chapter{予測モデル}

\section{予測のデザイン}

本稿では、サンプル企業1020社について、それぞれ1社ごとに1四半期先予測を12期(3年)分行う。まず、ある企業の全52四半期サンプル期間\footnote{実際のモデル推定では説明変数にラグ変数を含める。したがって利用できるサンプル期間は$52 - ラグの次数 $である。モデルのデザインによってラグの次数は異なるため、利用できる訓練データの長さもモデルによって異なる。}をもとに、1つあたり長さ41期のローリングサンプル(rolling sample)を12個形成する。次に、1つのローリングサンプルを、過去40期の訓練データ(training data, in-sample)と最新1期のテストデータ(test data, out-of-sample)に分ける。そして訓練データを用いてモデルを推定し、テストデータと同じ期にあたる1期先の予測を行う。これを12個のローリングサンプルで繰り返すことによって、ある企業の1四半期先予測が12期分得られる。


つまり具体的には、ある企業の全52四半期サンプル期間 $(Data_{\text{2008Q1}}, Data_{\text{2008Q2}}, \cdots, Data_{\text{2020Q4}})$ から12個のローリングサンプルを作り、1つ目の長さ41期のローリングサンプル $(Data_{\text{2008Q1}}, Data_{\text{2008Q2}}, \cdots, Data_{\text{2017Q4}}, Data_{\text{2018Q1}})$ を長さ40期の訓練データ $(Data_{\text{2008Q1}}, Data_{\text{2008Q2}}, \cdots, Data_{\text{2017Q4}})$ と長さ1期のテストデータ ($Data_{\text{2018Q1}})$ に分け、訓練データを用いてモデルを推定し、テストデータの説明変数を代入して訓練データの1期先の四半期EPS $y_{2018Q1}$ の予測値 $\hat{y}_{2018Q1}$ を求める。2つ目のローリングサンプル $(Data_{\text{2008Q2}}, Data_{\text{2008Q3}}, \cdots, Data_{\text{2018Q1}}, Data_{\text{2018Q2}})$ も同様に 訓練データ $(Data_{\text{2008Q2}}, Data_{\text{2008Q3}}, \cdots, Data_{\text{2018Q1}})$ を用いて1期先の四半期EPSの予測値 $\hat{y}_{2018Q2}$ を求める。同様に他のローリングサンプルに対しても、それぞれ同じモデルを異なる期間の訓練データで推定し、1企業につき12期分の1四半期先予測値系列 $(\hat{y}_{2018Q1}, \hat{y}_{2018Q2}, \cdots, \hat{y}_{2018Q2})$ が得られる。この予測プロセスを全サンプル企業1020社に対して行うことで、最終的に$12期 \times 1020社 = 12240個$の四半期EPS予測値が各予測手法から算出される。

図表は本稿のローリングサンプルによる1期先予測の概要を示している。

% ![rolling_sample](/mnt/d/0ngoing/thesis/repo/paper/my_writing/imgs/_rolling_sample.png) 
% <!-- blender使って、企業の軸も入れて3Dにするとかっこいい? -->

\section{伝統的時系列モデル}

\subsection{ランダムウォークモデル}

もっとも単純な単変量モデルであるランダムウォークモデルは次のとおりである。

\begin{equation}
  \begin{split}
    & Y_t = Y_{t-1} + \epsilon_t \\
    & ただし, \epsilon_t は全ての時点 t において \\
    & E[\epsilon_t] = 0 \\
    & E[\epsilon_t \epsilon_{t-k}] = \left\{
        \begin{array}{ll}
        \sigma^2 & k=0 \\
        0 & k \neq 0
\end{array}\right. \\
    & を満たすホワイトノイズである. \\
    & E[Y_t] = Y_{t-1} \\
\end{split}
\end{equation}    

一方、四半期EPS時系列には１年単位での季節的変動パターンがあると考えられる。そこでランダムウォーク過程を1四半期単位ではなく、1会計年度単位(4四半期)であると考慮した季節ランダムウォークモデルが次のとおりである。

\begin{equation}
  \begin{split}
    & Y_t = Y_{t-4} + \epsilon_t \\
    & E[Y_t] = Y_{t-4} \\
  \end{split}
\end{equation} 

ランダムウォークモデルは前四半期の実績値を、季節ランダムウォークモデルは前年同四半期の実績値を予測値とするモデルであり、どちらも実際の予測においてパラメータを推定する工程がない単純なモデルである。そこで、本稿ではランダムウォークモデル及び季節ランダムウォークモデルを他の予測に対するベンチマークとして用いる。

\subsection{ARIMAモデル}

従来の四半期EPSを予測する単変量線形時系列モデルとして、自己回帰和分移動平均(AutoRegressive Integrated Moving Average: ARIMA)モデル\citep{box2015time}\footnote{ARIMAモデルは提唱者の名前からBox-Jenkinsモデルとも呼ばれる。}、特にデータの季節性にも対応できるように一般化した季節自己回帰和分移動平均(Seasonal AutoRegressive Integrated Moving Average: SARIMA)モデルを用いる。$B^nY_t = y_{t-n}$ と定義されるような$B$(backshift operator)を導入すると、SARIMAモデルの一般形は以下のとおりである。\footnote{定数項$\theta_{\mu}=(1-\phi_1-\cdots-\phi_p)\mu$は階差をとれば0となるため、通常の取り扱いに従って0としている。}

\begin{equation}
  \begin{split}
    \phi_p(B)\Phi_{P}(B)(1-B)^d(1-B^s)^DY_t &= \theta_q(B)\Theta_Q(B^s)a_t \\
    ただし, \\
    p &: トレンドの自己回帰過程の階数 \\
    d &: トレンド階差の次数 \\
    q &: トレンドの移動平均過程の階数 \\
    P &: 季節変動の自己回帰過程の階数 \\
    D &: 季節階差の次数 \\
    Q &: 季節変動の移動平均過程の階数 \\
    s &: 季節変動の周期 \\
    \phi_p(B) &= (1 - \phi_1B - \cdots - \phi_pB^p) \\
    \theta_q(B) &= (1 - \theta_1B - \cdots - \theta_qB^q) \\
    \Phi_P(B^s) &= (1 - \Phi_1B^s - \cdots - \Phi_PB^{sP}) \\
    \Theta_Q(B^s) &= (1 - \Theta_1B^s - \cdots - \Theta_QB^{sQ}) \\
  \end{split}
\end{equation}

通常、SARIMAモデルは$(p, d, q) \times (P, D, Q)$の値の組み合わせをBox-Jenkins法によってデータごとに選定し、モデルの構築を行う。一方、これまでの四半期EPSの時系列予測の分野では全ての企業に適合するSARIMAモデルが探求され、次の3つのSARIMAモデル\citep*{foster1977quarterly, griffin1977time, brown1979univariate}があらゆる企業の四半期EPSの時系列特性を描写するモデルであるとされている。\footnote{先行研究では、企業ごとにモデルを構築するよりも、企業で共通の構築で予測したほうが全体として予測のパフォーマンスが良いと示されている。}

\begin{equation}
  \begin{split}
    \text{ Foster (1977) } &: (p, d, q) \times (P, D, Q)_s = (1, 0, 0) \times (0, 1, 0)_4 \\
    Y_t &= Y_{t-4} + \phi_1(Y_{t-1} - Y_{t-5}) + a_t \\
    E[Y_t] &= Y_{t-4} + \phi_1(Y_{t-1} - Y_{t-5}) + \delta \\
    \\
    \text{ Griffin (1977), Watts (1975) } &: (p, d, q) \times (P, D, Q)_s = (0, 1, 1) \times (0, 1, 1)_4 \\
    Y_t &= Y_{t-4} + (Y_{t-1} - Y_{t-5}) - \theta_1a_{t-1} - \Theta_1a_{t-4} + \theta_1\Theta_1a_{t-5} + a_t \\
    E[Y_t] &= Y_{t-4} + (Y_{t-1} - Y_{t-5}) - \theta_1a_{t-1} - \Theta_1a_{t-4} + \theta_1\Theta_1a_{t-5} + \delta \\
    \\
    \text{ Brown and Rozeff (1979) } &: (p, d, q) \times (P, D, Q)_s = (1, 0, 0) \times (0, 1, 1)_4 \\
    Y_t &= Y_{t-4} + \phi_1(Y_{t-1}-Y_{t-5}) - \Theta_1a_{t-4} + a_t \\
    E[Y_t] &= Y_{t-4} + \phi_1(Y_{t-1}-Y_{t-5}) - \Theta_1a_{t-4} + \delta \\
    \\
    & \text{ただし, }\delta\text{はSARIMAモデルの定数項.}
  \end{split}
\end{equation}

本稿では先行研究に倣い、特に支持されてきたこの3つのモデルを単変量線形時系列モデルとして用いることとする。

\subsection{多変量線形モデル}

ファンダメンタル会計変数が将来の四半期EPSを線形に説明するかどうかについて確かめるため、\cite*{lev1993fundamental}、\cite*{abarbanell1997fundamental}、\cite*{lorek1996multivariate}の研究で用いられているモデルを基に、以下のような多変量線形回帰モデルを考える。

\begin{equation}
  \begin{split}
    \label{mlm1}
    E[Y_t] = \alpha + \beta_1Y_{t-1} + \beta_2Y_{t-4} 
    &+ \beta_3INV_{t-1} + \beta_4AR_{t-1} + \beta_5CAPX_{t-1} \\
    &+ \beta_6GM_{t-1} + \beta_7SA_{t-1} + \beta_8ETR_{t-1} + \beta_9LF_{t-1} \\
  \end{split}
\end{equation}

\begin{equation}
  \begin{split}
    \label{mlm2}
    E[Y_t] = \alpha + \beta_1Y_{t-1} + \beta_2Y_{t-4} 
    &+ \beta_3INV_{t-4} + \beta_4AR_{t-4} + \beta_5CAPX_{t-4} \\
    &+ \beta_6GM_{t-4} + \beta_7SA_{t-4} + \beta_8ETR_{t-4} + \beta_9LF_{t-4} \\
  \end{split}
\end{equation}

2つのモデルはどちらも、四半期EPSの1四半期前ラグ$Y_{t-1}$と4四半期前ラグ$Y_{t-4}$が自己回帰的な説明変数として含まれている。両者の違いとしてはファンダメンタル会計変数のラグの次数にあり、(\ref{mlm1})のモデルではファンダメンタル会計変数の1四半期前ラグを、(\ref{mlm2})のモデルでは季節性を考慮してファンダメンタル会計変数の4四半期前ラグをモデルの説明変数として含めている。一方、Cao and Parry (2009) は後述する機械学習モデルと利用できる情報の公平性に保つため、以下のように四半期EPSとファンダメンタル会計変数のラグ変数を1四半期前、2四半期前、3四半期前、4四半期前すべて含めた多変量線形回帰モデルを推定している。

\begin{equation}
  \begin{split}
    E[Y_t] = \alpha + \sum^{4}_{\tau=1} \left( \beta_{1\tau}Y_{t-\tau} 
    + \beta_{2\tau}INV_{t-\tau} + \beta_{3\tau}AR_{t-\tau} + \beta_{4\tau}CAPX_{t-\tau} \right. \\
    \left. + \beta_{5\tau}GM_{t-\tau} + \beta_{6\tau}SA_{t-\tau} + \beta_{7\tau}ETR_{t-\tau} + \beta_{8\tau}LF_{t-\tau} \right) \\
  \end{split}
\end{equation}

以上のファンダメンタル会計変数を説明変数として用いた3つの多変量線形回帰モデルを多変量モデルのベンチマークとして、他の手法による多変量予測と比較する。なお、これらのモデルのパラメータは最小二乗法を用いてを推定する。

\section{機械学習モデル}

% 金融データは高次元、7変数しかもラグ、普通のモデルは変数多いと精度下がる。機械学習で次元削減。
% 金融データは非線形。非線形なモデル2つ。AnnとノンパラなRF

ここでは、本稿で用いる機械学習的手法について紹介する。なお、以下より共通して説明変数ベクトル$\bm{X}$については、単変量モデルにおいて、

\begin{equation}
  \begin{split}
    \bm{X} = (Y_{t-1}, Y_{t-2}, Y_{t-3}, Y_{t-4})
  \end{split}
\end{equation}

多変量モデルにおいて、

\begin{equation}
  \begin{split}
    \bm{X} = (
    & Y_{t-1}, Y_{t-2}, Y_{t-3}, Y_{t-4}, \\
    & INV_{t-1}, INV_{t-2}, INV_{t-3}, INV_{t-4}, \\
    & AR_{t-1}, AR_{t-2}, AR_{t-3}, AR_{t-4}, \\
    & CAPX_{t-1}, CAPX_{t-2}, CAPX_{t-3}, CAPX_{t-4}, \\
    & GM_{t-1}, GM_{t-2}, GM_{t-3}, GM_{t-4}, \\
    & SA_{t-1}, SA_{t-2}, SA_{t-3}, SA_{t-4}, \\
    & ETR_{t-1}, ETR_{t-2}, ETR_{t-3}, ETR_{t-4}, \\ 
    & LF_{t-1}, LF_{t-2}, LF_{t-3}, LF_{t-4}
    )
  \end{split}
\end{equation}

としてモデルを構築する。

\subsection{人工ニューラルネットワークモデル}

人工ニューラルネットワーク(Artificial Neural Network: ANN)モデルについて述べる。まずANNの構造の最小単位であるユニット(unit)またはニューロン(neuron)について考える。$(X_1, \cdots, X_k)$を入力ベクトルとする。$(w_1, \cdots, w_k)$は入力ベクトルの要素それぞれに対応する重み(weight)であり、スカラー値$b$はバイアス(bias)という。ユニットではまず始めに$(X_1, \cdots, X_k)$と$(w_1, \cdots, w_k)$の内積と$b$の和であるプレアクティベーション(pre-activation)$z$を計算する。

\begin{equation}
  \begin{split}
    z = w_1 X_1 + \cdots + w_k X_k + b
  \end{split}
\end{equation}

次に$z$は非線形な関数である活性化関数(activation function) $\phi(\cdot)$ に渡され、アクティベーション(activation)$a$として出力される。

\begin{equation}
  \begin{split}
    a = \phi(z)
  \end{split}
\end{equation}

以上がANNのユニットの構造であり、まとめると以下の式で表される。

\begin{equation}
  \begin{split}
    a = \phi(w_1 X_1 + \cdots + w_k X_k + b)
  \end{split}
\end{equation}

% ![ann_unit](/mnt/d/0ngoing/thesis/repo/paper/my_writing/imgs/_ann_unit.png)

このユニットを複数組み合わせることで、ANNが構成される。

ANNと一口に言っても様々な構造をもつ多くの種類がある。ANNの1種である順伝播型ニューラルネットワーク(feed-forward neural network: FFNN)はANNのなかでも基本的な構造を持ち、全てのユニットが結合した無閉路グラフ(acyclic graph)で表現されすべての計算が逐次的に行われる。FFNNの最も代表的なネットワークは多層パーセプトロン(multilayer perceptron: MLP)であり、図表のように表される。

% ![ann_mlp](/mnt/d/0ngoing/thesis/repo/paper/my_writing/imgs/_ann_mlp.png)

MLPの特徴として、横のつながりのユニットをそれぞれ層としてまとめると少なくとも3つ以上の層から構成される。またMLPはネットワークの全てのユニットが次の層に含まれる全てのユニットとそれぞれ結合している(fully connected)。ネットワークの最初の層は入力層(input layer)といい入力される特徴量がここにあたる。最後の層は出力層(output layer)といいネットワークが出力する値であり、出力層のアクティベーションは予測値を表す。この2つを除いた間の層は全て隠れ層(hidden layer)といい、MLPの多層構造を作る。

例えば、入力層と1層の隠れ層、出力層から成る3層パーセプトロンを定式化してみる。まず、隠れ層のアクティベーションをベクトル$(H_1, \cdots, H_L)$とする(activation vector)。ただし、$L$は隠れ層に含まれるユニットの数である。また、隠れ層の活性関数を $\phi^{(1)}(\cdot)$ とし、隠れ層のバイアス項を$(b^{(1)}_1, \cdots, b^{(1)}_L)$とすると、隠れ層のアクティベーションは以下のように表される。

\begin{equation}
  \begin{split}
    H_1 &= \phi^{(1)}(w^{(1)}_{11} X_1 + w^{(1)}_{21} X_2 + \cdots + w^{(1)}_{K1} X_K + b^{(1)}_1) \\
    H_2 &= \phi^{(1)}(w^{(1)}_{12} X_1 + w^{(1)}_{22} X_2 + \cdots + w^{(1)}_{K2} X_K + b^{(1)}_2) \\
    \vdots \\
    H_L &= \phi^{(1)}(w^{(1)}_{1L} X_1 + w^{(1)}_{2L} X_2 + \cdots + w^{(1)}_{KL} X_K + b^{(1)}_L) \\
  \end{split}
\end{equation}

 次に、出力層のについて考える。予測する変数は本稿では1次元であるため、出力層のアクティベーションはスカラー$Y$となる。出力層の活性関数を$\phi^{(2)}(\cdot)$とし、バイアス項を$b^{(2)}$とすると、出力層のアクティベーション(または予測値)は以下のように表される。

\begin{equation}
  \begin{split}
    Y = \phi^{(2)}(w^{(2)}_{1} H_1 + w^{(2)}_{2} H_2 + \cdots + w^{(2)}_{L} H_L + b^{(2)})
  \end{split}
\end{equation}

このように、MLPは線形結合モデルを非線形変換したものの繰り返しであることがわかる。このMLPの隠れ層の数を増やすことで、ネットワークをより深くすることができ、深層ニューラルネットワークが構築できる。一方、\cite{qi1999nonlinear}は隠れ層のユニット数が十分であれば、隠れ層が1つで、隠れ層の活性化関数にロジスティック関数、出力層の活性化関数に恒等関数を用いた3層パーセプトロンは、あらゆる連続関数を近似できると述べている。そこで本稿は、\cite{callen1996neural}や\cite{zhang2004neural}と同様に以下のような3層パーセプトロンANNモデルを用いる。

\begin{equation}
  \begin{split}
    Y_t &= f({\bf X, \alpha, \beta}) =\sum^{L}_{l=1} \left( \alpha_l H_l + \alpha_0 \right)= \sum^{L}_{l=1} \alpha_l \text{logsig} \left(\sum^{K}_{k=1} \left( \beta_{kl} X_k + \beta_{0l} \right) \right) \\
    ただし、\\
    Y_t &: 出力(目的変数) \\
    {\bf X}=(X_1, \cdots, X_{K}) &: 入力(説明変数)ベクトル \\
    X_k &: k番目の入力(説明変数) \\
    \alpha_l &: 隠れ層のl番目のユニットと目的変数のウェイト(パラメータ) \\
    L &: 隠れ層のユニット数 \\
    \alpha_0 &: 出力層のバイアス(定数項) \\
    \beta_{kl} &: k番目の入力(説明変数)と隠れ層のl番目のユニットのウェイト(パラメータ) \\
    \beta_{0l} &: 隠れ層のl番目のユニットのバイアス(定数項) \\
    \text{logsig}(\cdot) = \frac{\exp(\cdot)}{1 + \exp(\cdot)} &: ロジスティック関数
  \end{split}
\end{equation}

なお、ANNモデルの推定は誤差逆伝播法(Backward propagation algorithm)を用いてウェイトの勾配を計算し、勾配降下によって行う。

\subsection{正則化回帰モデル}

\begin{equation}
  \begin{split}
  \end{split}
\end{equation}

\subsection{ランダム・フォレスト回帰モデル}

\begin{equation}
  \begin{split}
  \end{split}
\end{equation}

\section{ハイパーパラメータの選択}

\chapter{予測精度指標}

\chapter{予測の精度と結果}

桜井1990の第4四半期が最も不正確なのと整合的

\chapter{予測の投資指標としての有用性}

\chapter{終わりに}

% https://www.eng.u-hyogo.ac.jp/faculty/hoshino/pc/tex_bibtex/
% http://mikilab.doshisha.ac.jp/dia/seminar/latex/doc/bib.html
\bibliographystyle{agsm} % Harvard style
\bibliographystyle{jplain}
\bibliography{ref}

\end{document}
